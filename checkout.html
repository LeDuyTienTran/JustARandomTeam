<!DOCTYPE html>

<html>

    <head>
        <meta charset="utf-8">

        <title>UTR | Checkout</title>

        <link rel="stylesheet" href="style.css">

        <script>
            let users = JSON.parse(localStorage.getItem('users')) || [];
            let current_user_index = parseInt(localStorage.getItem('current_user_index') || -1);

            function validatePayment() {
                event.preventDefault();

                const address = document.getElementById("address").value;
                const city = document.getElementById("city").value;
                const postcode = document.getElementById("postcode").value;
                // Store the delivery details in localStorage
                const deliveryDetails = {
                    address: address,
                    city: city,
                    postcode: postcode
                };
                localStorage.setItem('deliveryDetails', JSON.stringify(deliveryDetails));
                
                
                if (document.getElementById("cash-chosen") == null) {
                    const card_number = document.getElementById("card-number").value;
                    const card_name = document.getElementById("card-name").value;
                    const expiration_date = document.getElementById("expiration-date").value;
                    const cvv = document.getElementById("cvv").value;
                    
                    if ((address.length > 0 && city.length > 0 && postcode.length > 0) && (card_number.length > 0 && card_name.length > 0 && expiration_date.length > 0 && cvv.length > 0)) {
                        increaseOrders();
                        document.getElementById("pay-confirmed").innerText = "Payment confirmed. Tracking your order...";
                       
                        setTimeout(function () {
                            window.location.href = "trackOrder.html";
                        }, 2000);
                    }
                } else {
                    if (address.length > 0 && city.length > 0 && postcode.length > 0) {
                        increaseOrders();
                        document.getElementById("pay-confirmed").innerText = "Payment confirmed. Tracking your order...";
                       
                        setTimeout(function () {
                            window.location.href = "trackOrder.html";
                        }, 2000);
                    }
                }
            }

            function switchPaymentMethod(payment_method) {
                if (payment_method == "card") {
                    document.getElementById("payment-information").innerHTML =
                        "<div class='checkout-information'><label for='card-number'>Card Number</label><input type='text' id='card-number' placeholder='XXXX XXXX XXXX XXXX' required></div><div class='checkout-information'><label for='card-name'>Name on Card</label><input type='text' id='card-name' placeholder='Jane Doe' required></div><div class='checkout-information'><label for='expiration-date'>Expiration Date</label><input type='month' id='expiration-date' required></div><div class='checkout-information'><label for='cvv'>Security Code (CVV/CVC)</label><input type='text' id='cvv' maxlength='4' placeholder='100' required><p id='cvv-unhide'>What's this?</p><p id='cvv-hidden'>The security code is the last 3 digits on the back of your card. For American Express cards, the security code is a 4-digit number on the front of the card.</p></div>"
                    
                    document.getElementById("card-method").style = "background-color: var(--hover-color)"
                    document.getElementById("cash-method").style = "background-color: var(--secondary-color)"
                } else {
                    document.getElementById("payment-information").innerHTML =
                        "<p id='cash-chosen'>Please prepare the required amount and await your delivery.</p>"

                    document.getElementById("cash-method").style = "background-color: var(--hover-color)"
                    document.getElementById("card-method").style = "background-color: var(--secondary-color)"
                }
            }

            function increaseOrders() {
                users[current_user_index].orders += 1;

                if (users[current_user_index].orders === 3) {
                    addAchievement(2);
                } else if (users[current_user_index].orders === 6) {
                    addAchievement(3);
                }

                localStorage.setItem("users", JSON.stringify(users));
            }

            function addAchievement(achievementId) {
                users[current_user_index].achievements.push(achievementId);
            }
        </script>
    </head>

    <body>
        <header>
            <nav>
                <ul>
                    <div id="logo">UTR</div>

                    <li>
                        <a href="home.html">Home</a>
                    </li>
                    <li>
                        <a href="locations.html">Locations</a>
                    </li>
                    <li>
                        <a href="Food & Beverage.html">Food & Beverage</a>
                    </li>
                    <li>
                        <a href="Gas & Go.html">Gas & Go</a>
                    </li>
                    <li>
                        <a href="account.html" id="login-link">Account</a>
                    </li>
                    <li><a href="Achievement.html">Achievement</a></li>

                    <a href="cart.html" id="cart-link">
                        <img src="images/cart.png" alt="Image of a cart" id="cart-icon"/>
                    </a>
                </ul>
            </nav>
        </header>

        <main>
            <div>
                <h1>Payment Information</h1>

                
                <form id="checkout-container" onsubmit="validatePayment()">
                    <div>
                        <a href="cart.html">Return to Cart</a>
                        
                        <h2>Delivery Address</h2>

                        <div class="checkout-information">
                            <label for="address">Address</label>
                            <input type="text" id="address" placeholder="123 Main Street" required>
                        </div>

                        <div class="checkout-information">
                            <label for="city">City/Suburb</label>
                            <input type="text" id="city" placeholder="Mawson Lakes" required>
                        </div>

                        <div class="checkout-information">
                            <label for="postcode">Postcode</label>
                            <input type="text" id="postcode" maxlength="4" placeholder="5000" required>
                        </div>
                    </div>
        
                    <div>
                        <h2>Payment Method</h2>

                        <div id="payment-method">
                            <button type="button" id="card-method" onclick="switchPaymentMethod('card')">Card</button>
                            <button type="button" id="cash-method" onclick="switchPaymentMethod('cash')">Cash</button>
                        </div>

                        <div id="payment-information">
                            <div class="checkout-information">
                                <label for="card-number">Card Number</label>
                                <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX" required>
                            </div>
                            
                            <div class="checkout-information">
                                <label for="card-name">Name on Card</label>
                                <input type="text" id="card-name" placeholder="Jane Doe" required>
                            </div>

                            <div class="checkout-information">
                                <label for="expiration-date">Expiration Date</label>
                                <input type="month" id="expiration-date" required>
                            </div>

                            <div class="checkout-information">
                                <label for="cvv">Security Code (CVV/CVC)</label>
                                <input type="text" id="cvv" maxlength="4" placeholder="100" required>
                                <p id="cvv-unhide">What's this?</p>
                                <p id="cvv-hidden">The security code is the last 3 digits on the back of your card. For American Express cards, the security code is a 4-digit number on the front of the card.</p>
                            </div>
                        </div>
                    </div>
            
                    <div class="summary">
                        <h2>Order Summary</h2>
                        
                        <p>Subtotal: <span>$7.50</span></p>
                        <p>Delivery Fee: <span>$2.99</span></p>
                        <p>Service Fee: <span>$1.75</span></p>

                        <div class="total">
                            <p>Total: <span>$12.24</span></p>
                        </div>
                    </div>
            
                    <button type="submit" id="pay-button">Pay Now</button>
                    <p id="pay-confirmed"></p>
                </div>
            </div>
        </main>

        <footer>
            Â©Copyright UTR Pty Ltd, 2024. All rights reserved.
        </footer>
    </body>
</html>
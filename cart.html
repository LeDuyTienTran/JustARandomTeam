<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">

        <title>UTR | Cart</title>

        <link rel="stylesheet" href="style.css">

        <script>
            let cart = JSON.parse(localStorage.getItem('cart')) || [];

            function createCartItem() {
                if (cart.length > 0) {
                    for (let i = 0; i < cart.length; i++) {
                        let item = cart[i];
                        let name = item.name;
                        let price = parseFloat(item.price).toFixed(2);
                        let quantity = item.quantity;

                        document.getElementById("cart-container").innerHTML +=
                            "<div class='cart-item' id='" + name + "'><img src='images/remove.png' id='remove-button' alt='Image of a remove button' onclick='removeCartItem(\"" + name + "\")' /><div class='item-details'><p>" + name + "</p><p>$" + price + "</p></div><div class='quantity-controls'><button onclick='changeQuantity(\"" + name + "\", " + price + ", -1)'>-</button><input type='number' id='" + name + "-quantity' value='" + quantity + "' readonly><button onclick='changeQuantity(\"" + name + "\", " + price + ", 1)'>+</button></div><div class='item-total' id='" + name + "-total'>$" + (price * quantity).toFixed(2) + "</div></div>"
                    }

                    document.getElementById("cart-container").innerHTML +=
                        "<a href='checkout.html'><button class='checkout-button'>Proceed to Checkout</button></a>"
                } else {
                    document.getElementById("cart-container").innerHTML +=
                        "<p id='empty-cart'>There's nothing in your cart. Add more <a href='Food & Beverage.html'>food and beverage</a> or <a href='Gas & Go.html'>fuel</a>.</p>"
                }
            }
            
            function changeQuantity(name, price, quantity) {
                let quantity_element = document.getElementById(name + '-quantity');
                let current_quantity = parseInt(quantity_element.value);
                let new_quantity = current_quantity + quantity;
                
                if (new_quantity < 1) {
                    new_quantity = 1;
                }
                
                quantity_element.value = new_quantity;

                const existing_item_index = cart.findIndex(cart_item => cart_item.name === name);
                cart[existing_item_index].quantity += quantity;
                localStorage.setItem('cart', JSON.stringify(cart));

                updateItemTotal(name, price, new_quantity);
            }

            function updateItemTotal(item, price, new_quantity) {
                let totalElement = document.getElementById(item + '-total');
                totalElement.innerHTML = '$' + (price * new_quantity).toFixed(2);
            }

            function removeCartItem(name) {
                document.getElementById(name).remove();

                const existing_item_index = cart.findIndex(cart_item => cart_item.name === name);
                cart.splice(existing_item_index, 1);
                localStorage.setItem('cart', JSON.stringify(cart));

                if (cart.length == 0) {
                    document.getElementById("cart-container").innerHTML =
                        "<p id='empty-cart'>There's nothing in your cart. Add more <a href='Food & Beverage.html'>food and beverage</a> or <a href='Gas & Go.html'>fuel</a>.</p>"
                }
            }
        </script>
    </head>

    <body onload="createCartItem()">
        <header>
            <nav>
                <ul>
                    <div id="logo">UTR</div>

                    <li>
                        <a href="home.html">Home</a>
                    </li>
                    <li>
                        <a href="locations.html">Locations</a>
                    </li>
                    <li>
                        <a href="Food & Beverage.html">Food & Beverage</a>
                    </li>
                    <li>
                        <a href="Gas & Go.html">Gas & Go</a>
                    </li>
                    <li>
                        <a href="account.html" id="login-link">Account</a>
                    </li>

                    <a href="cart.html" id="cart-link">
                        <img src="images/cart.png" alt="Image of a cart" id="cart-icon"/>
                    </a>
                </ul>
            </nav>
        </header>

        <main>
            <div>
                <h1>Your Cart</h1>
    
                <div id="cart-container"></div>    
            </div>        
        </main>

        <footer>
            Â©Copyright UTR Pty Ltd, 2024. All rights reserved.
        </footer>
    </body>

</html>